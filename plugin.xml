<?xml version='1.0' encoding='utf-8'?>
<plugin id="cordova-plugin-ar" version="0.0.1" xmlns="http://apache.org/cordova/ns/plugins/1.0" xmlns:android="http://schemas.android.com/apk/res/android">
    <name>cordova-plugin-ar</name>
    
    <js-module name="cordova-plugin-ar" src="www/cordova-plugin-ar.js">
        <clobbers target="cordova.plugins.ar"/>
    </js-module>

    <platform name="android" kotlin="1.3.31">
        <framework src="src/android/build-extras.gradle" custom="true" type="gradleReference" />
        <framework src="org.jetbrains.kotlin:kotlin-stdlib-jdk8:1.3.31" />

        <!-- Add Kotlin support -->
        <hook type="after_plugin_add" src="hooks/support-kotlin.js" />
        <hook type="after_platform_add" src="hooks/support-kotlin.js" />

        <apply-plugin>kotlin-android-extensions</apply-plugin>
        <apply-plugin>kotlin-kapt</apply-plugin>

        <!-- Cleanup Kotlin source on uninstall -->
        <hook type="before_plugin_rm" src="hooks/on-uninstall.js" />
        <hook type="before_plugin_uninstall" src="hooks/on-uninstall.js" />

        <config-file target="config.xml" parent="/*">
            <feature name="ARPlugin">
                <param name="android-package" value="com.gj.arcoredraw.MeasurePlugin"/>
            </feature>
        </config-file>
        <config-file target="AndroidManifest.xml" parent="/*">
            <uses-permission android:name="android.permission.CAMERA" />
            <uses-feature android:name="android.hardware.camera" android:required="true" />
            <uses-feature android:name="android.hardware.camera.ar" android:required="true" />
        </config-file>
        <config-file target="AndroidManifest.xml" parent="/manifest/application">
            <activity android:name="com.gj.arcoredraw.ARPluginActivity" android:label="AR Activity" android:theme="@style/Theme.AppCompat.Light">
            </activity>
            <meta-data android:name="com.google.ar.core" android:value="optional" />
            <meta-data android:name="com.google.ar.sceneform.ux" android:value="optional" />
        </config-file>

        <source-file src="src/android/ARPlugin.kt" target-dir="app/src/main/java/cordova/plugin"/>
        <source-file src="src/android/ARPluginActivity.kt" target-dir="app/src/main/java/cordova/plugin"/>
        <source-file src="src/android/AnchorInfoBean.kt" target-dir="app/src/main/java/cordova/plugin"/>
        <source-file src="src/android/FaceToCameraNode.kt" target-dir="app/src/main/java/cordova/plugin"/>

        <source-file src="src/android/activity_arplugin.xml" target-dir="res/layout"/>
        <source-file src="src/android/renderable_text.xml" target-dir="res/layout"/>
        <source-file src="src/android/shape_rect_whtie_18.xml" target-dir="res/drawable"/>
        <source-file src="src/android/ar_last.png" target-dir="res/drawable"/>
        <source-file src="src/android/ar_post.png" target-dir="res/drawable"/>
    </platform>

    <platform name="ios">
        <preference name="CAMERA_USAGE_DESCRIPTION" default="Used by ARKit" />
        <config-file target="*-Info.plist" parent="NSCameraUsageDescription">
            <string>$CAMERA_USAGE_DESCRIPTION</string>
        </config-file>

        <config-file target="config.xml" parent="/*">
            <feature name="ARPlugin">
                <param name="ios-package" value="HWPArKitPlugin"/>
            </feature>
        </config-file>

        <source-file src="src/ios/ArKitPlugin.swift"/>
        <source-file src="src/ios/ArKitPlugin+ARViewControllerDelegate.swift"/>
        <source-file src="src/ios/QRCodeGenerator.swift"/>

        <!-- ARViewController -->
        <source-file src="src/ios/ViewControllers/ARViewController/ARViewController.swift"/>
        <source-file src="src/ios/ViewControllers/ARViewController/ARViewController+ARSCNViewDelegate.swift"/>
        <source-file src="src/ios/ViewControllers/ARViewController/ARViewController+ARSessionDelegate.swift"/>
        <source-file src="src/ios/ViewControllers/ARViewController/ARViewController+Vision.swift"/>

        <!-- StatusViewController -->
        <source-file src="src/ios/ViewControllers/StatusViewController/StatusViewController.swift"/>

        <!-- Resources -->
        <resource-file src="src/ios/Resources/Main.storyboard" />

        <dependency id="cordova-plugin-add-swift-support" version="~1.7" />
    </platform>
</plugin>